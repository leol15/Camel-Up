<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>GAME</title>
	<style type="text/css">
		html, body {
			padding: 0;
			margin: 0;
		}
		* {
			box-sizing: border-box;
			font-family: monospace;
		}

		/*link banner*/
		#banner {
			font-size: 1.2em;
			background-color: black;
			color: white;
			text-align: center;
			padding: 15px;
			transition: all 0.5s;
		}
		#banner:hover {
			cursor: pointer;
		}
		#banner:active {
			transition: all 0.2s;
			background-color: white;
		}

		/*pick name*/
		#name-input {
			text-align: center;
		}
	</style>
</head>
<body>
	<!-- display game link -->
	<div id="banner" onclick="copyLinkAddress()"></div>
	<h1>Wellcome!</h1>
	<!-- pick name -->
	<center>
		<input onchange="sumbmitName(this)" id="name-input" type="text" placeholder="pick a name" autofocus>
	</center>

	<script type="text/javascript">
		// fill banner with link address
		let banner_el = document.getElementById('banner')
		// get link name
		let GAME_ID = window.location.pathname.split("/")[2]
		banner_el.innerHTML = "Game link: " + GAME_ID + " (Click to copy)";
		// dummy_link_el.style.display = "none";
		function copyLinkAddress() {
			let dummy_link_el = document.createElement("input");
			dummy_link_el.value = window.location;
			document.body.appendChild(dummy_link_el);
			dummy_link_el.select();
			dummy_link_el.setSelectionRange(0, 99999); /*For mobile devices*/
			document.execCommand("copy");
			dummy_link_el.remove();
		}

		// static final variables
		let GAME_COMM_ROUTE = "gamespeaks/" + GAME_ID
		let NAME_KEY = "uname"
		// getters
		let DICE_KEY = "dice"
		let BET_KEY = "bet"
		let PLAYERS_KEY = "players"
		let GLOBAL_BET_KEY = "makeBet"
		let CAMELS_KEY = "camels"
		// mutator
		let MAKE_ROLL_KEY = "roll"
		let MAKE_BET_KEY = "makeBet"

		let user_name = ""
		// helpers
		// return a promise, use then
		// will try to consume a json or text
		function fetch_url(url) {
			console.log("fetching [" + url + "]")
			return fetch(url)
				.then(res => {
					let type = res.headers.get('content-type')
					if (type.includes("application/json")) {
						return res.json()
					} else if (type.includes("text")) {
						return res.text()
					} else {
						return res.data()
					}
				})
				.then(thing => {
					console.log("v.v.v.v.v")
					console.log(thing);
					console.log("^.^.^.^.^")
					return thing
				})
				.catch(err => console.log(err));
		}

		// request using a game action		
		function gameAction(action) {
			return fetch_url(GAME_COMM_ROUTE + "?action=" + action);
		}

		// set uname send address
		function sumbmitName(form) {
			// body...
			console.log(form.value)
			gameAction(NAME_KEY + "&" + NAME_KEY + "=" + form.value)
				.then(name => {
					user_name = name;
					console.log(name)
				})
		}


	</script>
</body>
</html>